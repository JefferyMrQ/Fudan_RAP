## 属性配置

> 参考`./data/field_data.yaml`

- 在这个配置文件中，包含对三类属性的配置：`业务对象A属性`、`业务对象B属性`、`事件属性`
- 其结构为`属性中文名: sql查询时所需的属性字段`
- `业务对象A属性`和`业务对象B属性`分别定义了各自业务对象特有的属性配置
- `事件属性`定义了`度量`属性和`时间属性`等事件相关属性的配置


## framework设计

> 参考`./data/analysis_data.yaml`

#### framework基本结构

- 两层结构
```yaml
分析类型:
  指标:
    业务对象A: 自定义对象(info)
    业务对象A属性: 根据规范定义对象属性
    业务对象A属性值: 根据规范定定义对象属性值
    业务对象B: 自定义对象(info)
    业务对象B属性: 根据规范定义对象属性
    业务对象B属性值: 根据规范定定义对象属性值
    事件: 自定义事件(info)
    事件属性: 自定义事件属性(info)
    度量: 选择度量，需要结合字段名-字段的配置文件进行修改
    时间: 选择时间类型
    统计方法: 选择统计方法
```
- 三层结构
```yaml
分析类型:
  子分析类型:
    指标:
      业务对象A: 自定义对象(info)
      业务对象A属性: 根据规范定义对象属性
      业务对象A属性值: 根据规范定定义对象属性值
      业务对象B: 自定义对象(info)
      业务对象B属性: 根据规范定义对象属性
      业务对象B属性值: 根据规范定定义对象属性值
      事件: 自定义事件(info)
      事件属性: 自定义事件属性(info)
      度量: 选择度量，需要结合字段名-字段的配置文件进行修改
      时间: 选择时间类型
      统计方法: 选择统计方法
```
#### framework各子项具体说明
- 业务对象A
>根据业务需求自定义对象，只作为framework的信息，不作为解析参数

- 业务对象A属性
>根据目前设计的规范撰写属性描述，目前主要有如下几种结构
>
>1. 主属性：<br>
`主属性`，或者称作主字段，其设定是因为只有主属性会存在存量/新增/流失/净增等等特殊值，因此所有的业务对象A属性描述都具有主属性，目前业务中主属性为`客户id`。
>2. (TBD)主属性+/待定属性：<br>
只有待定属性的情况<br>
`(TBD)`只是描述待确定的一个前缀提示符，在目前的解析器中是无用信息；<br>
`+/`符号描述可能添加，即有可能不添加；<br>
`待定属性`是指不确定的维度下钻，例如在一维下钻时，如果参数dim_A非空，可用其替换`待定属性`，成为具体属性。e.g.`dim_A = '省份'`&rarr;`待定属性->省份`。在二维下钻时，dim_A中间含有`-`号。e.g.`dim_A = '客户类型-省份'`&rarr;`待定属性->政府, 省份`。<br>
>3. 主属性+固定属性：<br>
只有固定属性的情况<br>
`+`号描述添加一个固定属性，例如目前业务在关键客群分析中需要添加固定属性“客户等级”。<br>
>4. (TBD)主属性+固定属性+/待定属性：<br>
既有固定属性，又有待定属性的情况<br>
>
><font color=orange>说明：目前的解析器并不支持自定义上述结构，例如`主属性+固定属性1+固定属性2`等等，如果有撰写不同的结构的业务需求，建议先查看源码有没有对应的解析，并尝试添加和优化</font>

- 业务对象A属性值
>根据对象A属性的不同，相应的有不同的属性值
>
>1. 主属性：all/存量／新增／流失／净增／[存量, 新增, 流失]<br>
其中`all`描述查询全体，无需任何解析；`[存量, 新增, 流失]`描述占比分析><font color=blue>（可以尝试与下面的`(...vs...)`结构合并成一个，只采用其中一个结构即可）</font>。<br>
>2. 固定属性：该属性的任何可能的取值/(取值1 vs 取值2 vs...)/(取值1 vs other)/groupby<br>
其中`(...vs...)`结构用于多个取值对象的占比分析；`groupby`用于该维度的排名分析等。<br>
>3. 待定属性：待定值<br>
`待定值`会根据传入解析器的`dim_val_A`参数进行解析替换，目前支持一维和二维下钻的情况。<br>

- 业务对象B
>类同`业务对象A`

- 业务对象B属性
>目前仅仅支持一个固定维度，例如目前业务中就是`产品名`

- 业务对象B属性值
>跟A中不同，这里的固定值有三种不同情况：<br>
>1. (TBD)all/groupby：<br>
`/`描述或的关系，描述取其中一个值。具体取什么值，要根据`dim_B`是否为空来判断<br>
>2. (TBD)all/待定值<br>
同上<br>
>3. all：<br>
无约束<br>

- 事件
>描述信息，不作为解析参数

- 事件属性
>描述信息，不作为解析参数

- 度量
>统计度量，例如收入分析中用`出账收入`，对应字段`income`；客户数分析中用`客户id`，对应字段`customer_id`

- 时间
>目前存在的时间类型<br>
某月：用户传入的日期（某月月初至某月月末）<br>
某月+同比：传入日期同比（某月月初至某月月末、去年某月月初至某月月末）<br>
今年：今年指标（今年第一天至本月末）<br>
今年+同比：今年同比指标（今年第一天至本月末，去年第一天至同期月末）<br>
今年+每月：今年每月指标（今年第一天至本月末，按月分组）<br>
本月：本月指标（本月初至本月末）<br>
本月+同比：本月同比指标（本月初至本月末、去年本月初至本月末）<br>
过去K个月+每月：过去K个月每月（过去1个月描述上个月月初至本月月末，按月分组）<br>
过去K个月+每月+同比：过去K个月每月同比（同上，添加上年各月查询）<br>
最近连续月份+每月：同“过去K个月+每月”，设定K为默认最大值<br>
最近连续月份+每月+同比：同“过去K个月+每月+同比”，设定K为默认最大值<br>

- 统计方法
>目前有两个基本的统计方法：`sum`和`count distinct`，分别对应sql的`sum(field)`和`count(distinct field)`
>
>还有一个特殊的统计方法：sum+avg，目前需要嵌套查询，是一个需要优化的部分

